---
title: "Sydney_property_sold_2016_2022"
author: "Ha Luong"
date: "4/22/2023"
output: github_document
---

```{r setup, include=FALSE}
#install.packages(tidyverse)
#library(tidyverse)
#install.packages(ggplot2)
#library(ggplot2)

setwd("~/Documents/Sydney Housing Price")
df <- read_csv("formatted.csv")
knitr::opts_chunk$set(echo = TRUE)
```
# Summary columns and column type
```{r}
str(df)
```
Create column "year" from column date_sold to analyze by year
```{r}
df$year <- format(df$date_sold, format="%Y")
```
# Cleaning data
## Summary data
```{r}
summary(df)
```
## Check for inappropriate data and outliner, elimitate outliners using Empirical rule  (House Price > 5.540.000 AUD, number of bed > 9, number of bath > 6)
```{r}
mean(df$num_bed)
sd(df$num_bed)
mean(df$num_bath)
sd(df$num_bath)
```
```{r}
cleaned_df <- df[!(df$price > 5540000) & !(df$num_bed >9) & !(df$num_bath > 6),]
str(cleaned_df)
```
# Some general analysis
## Average property sold price by date_soldafter data cleaning
```{r}
options(scipen = 999)
ggplot(cleaned_df, aes(x = date_sold, y= price)) + 
  geom_bar(stat = "summary", fun = "mean", fill="#56B4E9") +
  geom_smooth(method=lm)+
  labs(x = 'Time', y = 'Price', fill = 'type', title = 'Average price after cleaning')
```
## Average property price by year
```{r}
options(scipen = 999)
ggplot(cleaned_df, aes(x = year, y=price)) + 
  geom_bar(stat = "summary", fun = "mean", fill="#56B4E9") +
  labs(x = 'Price', y = 'Year)', fill = 'type', title = 'Average price by year')
```

## Average property price by year for different property types
```{r}
options(scipen = 999)
ggplot(cleaned_df, aes(x = year, y= price)) + 
  geom_bar(stat = "summary", fun = "mean", fill="#56B4E9") +
  facet_wrap(~type)+
  labs(x = 'Year', y = 'Price)', fill = 'type', title = 'Average price by year')
```

# Analyze 3 main housing types
## Create a vector of the four main types
```{r}
main_types <- c("House", "Apartment / Unit / Flat", "Townhouse")
cleaned_df$type_grouped <- ifelse(cleaned_df$type %in% main_types, cleaned_df$type, "others")
print(cleaned_df)
```
## Number of sold property by main types and other
```{r}
options(scipen = 999)
ggplot(data=cleaned_df) +
  geom_bar(mapping=aes(x = type_grouped, fill=type_grouped))
```

## Average property price by year for 3 main property types and other types
```{r}
options(scipen = 999)
ggplot(cleaned_df, aes(x = year, y= price)) + 
  geom_bar(stat = "summary", fun = "mean", fill="#56B4E9") +
  facet_wrap(~type_grouped)+
  labs(x = 'Price', y = 'Year)', fill = 'type_grouped', title = 'Average price by year')
```
## Price distribution by year
```{r}
hist(cleaned_df$price, xlab = 'Price (AUD)', ylab = 'Number of sold', main = 'Distribution of House Prices from 2016-2022')
```

## Price =by date of sold for 3 main property types and other types
```{r}
options(scipen = 999)
ggplot(cleaned_df, aes(x = date_sold, y = price, alpha = date_sold))+
   geom_point(colour = 6) +
  facet_wrap(~type_grouped)+
  geom_smooth(method=lm)+
  labs(x = 'Time', y = 'Price', fill = 'type_grouped', title = 'Price by time')
```
## Price distribution by property types
```{r}
ggplot(cleaned_df, aes(x = price)) +
  geom_histogram(aes(color = type_grouped, fill = type_grouped), 
                bins = 30, alpha = 0.4)
```
# Analyze pricer per property size (m2)
## Create new "price_per_size" column
```{r}
cleaned_df$price_per_size <- cleaned_df$price/cleaned_df$property_size
summary(cleaned_df$price_per_size)
```
## Price per size by year for different property types
```{r}
options(scipen = 999)
ggplot(cleaned_df, aes(x = year, y= price_per_size)) + 
  geom_bar(stat = "summary", fun = "mean", fill="#56B4E9") +
  facet_wrap(~type_grouped)+
  labs(x = 'Price per size', y = 'Year)', fill = 'type_grouped', title = 'Average price per housing size by year')
```
## Test for correlation between price and other property features
```{r}
price_vs_size <- cor.test(cleaned_df$price, cleaned_df$property_size, 
                    method = "pearson")
price_vs_size
```

```{r}
price_vs_distance <- cor.test(cleaned_df$price, cleaned_df$km_from_cbd, 
                    method = "pearson")
price_vs_distance
```

```{r}
price_vs_population <- cor.test(cleaned_df$price, cleaned_df$suburb_population, 
                    method = "pearson")
price_vs_population
```

```{r}
price_vs_income <- cor.test(cleaned_df$price, cleaned_df$suburb_median_income, 
                    method = "pearson")
price_vs_income
```

```{r}
price_vs_elevation <- cor.test(cleaned_df$price, cleaned_df$suburb_elevation, 
                    method = "pearson")
price_vs_elevation 
```

# Save cleaned data to a new file
```{r}
cleaned_df %>%
  write.csv("domain_properties_clean.csv")
```



